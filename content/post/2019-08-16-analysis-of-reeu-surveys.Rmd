---
title: Analysis of REEU surveys
author: Lucky Mehra
date: '2019-08-16'
slug: analysis-of-reeu-surveys
categories: []
tags:
  - reeu
  - undergradute
  - research
  - extension
  - rstats
  - rmarkdown
authors: []
header:
  caption: ''
  image: ''
  preview: yes
output:
  blogdown::html_page:
    toc: true
---

```{r load-pkgs, echo=FALSE, message=FALSE}
# install package manager `pacman`
if(!require(pacman)){
	install.packages("pacman")
}

# install and load packages needed for this document
pacman::p_load(tidyverse,
							 tidytext,
							 likert,
							 googlesheets,
							 rlang,
							 knitr,
							 kableExtra,
							 plotrix)

```

## Pre-survey

```{r pre-survey, results='hide', echo=FALSE, message=FALSE}
# read the sheet from google drive
REEU <- gs_title("student_assessment")

# pre-survey data
pre_reeu_data <- REEU %>% 
	gs_read(ws = 1) %>% 
	dplyr::select(-question_prefix, -question_text)

# question labels
pre_reeu_lookup <- REEU %>% 
	gs_read(ws=1) %>% 
	dplyr::select(question_number, question_prefix, question_text) %>% 
	slice(1:30) %>% 
	mutate(question = paste(question_prefix, question_text))

# make the dataset wide
pre_reeu_data_num <- pre_reeu_data %>% 
	dplyr::select(-response_chr) %>% 
	filter(!is.na(response_num)) %>% 
	spread(key = question_number,
				 value = response_num) %>% 
	select(-student_num) %>% 
	mutate_all(round, 0) %>% 
	mutate_all(factor, levels = c("1", "2", "3", "4", "5"), ordered = TRUE) %>% 
	as.data.frame()

result <- likert(pre_reeu_data_num)

median_resp <- pre_reeu_data_num %>% 
	mutate_all(as.numeric) %>% 
	summarise_all(median, na.rm = TRUE) %>% 
	gather(key = "question_number",
				 value = "median") %>% 
	mutate(question_number = as.numeric(question_number))

```

### High rated questions

Questions that were rated 4 and higher by students on a scale of 1 to 5. `1` = Not at all, `2` = Just a little, `3` = Somewhat, `4` = A lot, `5` = A great deal.  

```{r pre-survey-split, echo=FALSE}
high_rated_qs <- summary(result) %>% 
	filter(high >=87) %>% 
	select(Item)

high_rated_qs <- high_rated_qs[,1]

med_rated_qs <- summary(result) %>% 
	filter(between(high, 37, 87)) %>% 
	select(Item)

med_rated_qs <- med_rated_qs[,1]

low_rated_qs <- summary(result) %>% 
	filter(high < 37) %>% 
	select(Item)

low_rated_qs <- low_rated_qs[,1]

result_high <- pre_reeu_data_num %>% 
	select(as.character(high_rated_qs)) %>% 
	likert()

plot(result_high)

```

Full question text is in the following talbe:  

```{r high-questions, echo=FALSE, message=FALSE}
get_questions <- function(rated_qs, result_lev){
questions <- pre_reeu_lookup %>% 
	dplyr::select(-question) %>% 
	filter(question_number %in% {{rated_qs}}) %>% 
	left_join(summary({{result_lev}}) %>% 
							mutate(question_number = as.numeric(as.character(Item)))) %>%
	left_join(filter(median_resp, question_number %in% {{rated_qs}})) %>% 
	arrange(high) %>% 
	dplyr::select(1:3, "median")

questions <- questions[nrow(questions):1,]

kable(questions) %>% 
	kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
}

get_questions(rated_qs = high_rated_qs,
							result_lev = result_high)
```

### Medium rated questions  

Questions to which most students responded 3 and up on a scale of 1 to 5. `1` = Not at all, `2` = Just a little, `3` = Somewhat, `4` = A lot, `5` = A great deal.

```{r, echo=FALSE}
result_med <- pre_reeu_data_num %>% 
	select(as.character(med_rated_qs)) %>% 
	likert()

plot(result_med)
```

Full question text is in the following talbe: 

```{r, echo=FALSE, message=FALSE}
questions <- pre_reeu_lookup %>% 
	dplyr::select(-question) %>% 
	filter(question_number %in% med_rated_qs) %>% 
	left_join(summary(result_med) %>% 
							mutate(question_number = as.numeric(as.character(Item)))) %>% 
	left_join(filter(median_resp, question_number %in% med_rated_qs)) %>% 
	arrange(high) %>% 
	dplyr::select(1:3, "median")

questions <- questions[nrow(questions):1,]

kable(questions) %>% 
	kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Low rated questions  

Questions to which most student responded 1 or 2 on a scale of 1 to 5. `1` = Not at all, `2` = Just a little, `3` = Somewhat, `4` = A lot, `5` = A great deal.

```{r, echo=FALSE}
result_low <- pre_reeu_data_num %>% 
	select(as.character(low_rated_qs)) %>% 
	likert()

plot(result_low)
```

Full question text is in the following talbe: 

```{r, echo=FALSE, message=FALSE}
get_questions(rated_qs = low_rated_qs,
							result_lev = result_low)

```

### Text entry questions  

**Answers to question # 28:** *`r pre_reeu_lookup$question_text[28]`*

```{r wc-q28, echo=FALSE, message=FALSE}

# text responses
pre_reeu_data_chr <- pre_reeu_data %>% 
	dplyr::select(-response_num) %>% 
	filter(!is.na(response_chr)) %>% 
	spread(key = question_number,
				 value = response_chr)

kable(pre_reeu_data_chr$`28`, col.names = "Student responses")%>% 
	kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

**Answers to question # 29:** *`r pre_reeu_lookup$question_text[29]`*

```{r wc-q29, echo=FALSE, message=FALSE}
knitr::kable(pre_reeu_data_chr$`29`, col.names = "Student responses")%>% 
	kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

**Answers to question # 30:** *`r pre_reeu_lookup$question_text[30]`*

```{r wc-q30, echo=FALSE, message=FALSE}
knitr::kable(pre_reeu_data_chr$`30`, col.names = "Student responses")%>% 
	kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

## Post survey

```{r post-survey, results='hide', echo=FALSE, message=FALSE}
# post-survey data
post_reeu_data <- REEU %>% 
	gs_read(ws = 2) %>% 
	dplyr::select(-question_prefix, -question_text)

# question labels
post_reeu_lookup <- REEU %>% 
	gs_read(ws = 2) %>% 
	dplyr::select(question_number, question_prefix, question_text) %>% 
	slice(1:40) %>% 
	mutate(question = paste(question_prefix, question_text))

# make the dataset wide
post_reeu_data_num <- post_reeu_data %>% 
	dplyr::select(-response_chr) %>% 
	filter(!is.na(response_num)) %>% 
	spread(key = question_number,
				 value = response_num) %>% 
	select(-student_num) %>% 
	mutate_all(round, 0) %>% 
	mutate_all(factor, levels = c("1", "2", "3", "4", "5"), ordered = TRUE) %>% 
	as.data.frame()

result_post <- likert(post_reeu_data_num)

# calculate median of all questions
median_resp_post <- post_reeu_data_num %>% 
	mutate_all(as.numeric) %>% 
	summarise_all(median, na.rm = TRUE) %>% 
	gather(key = "question_number",
				 value = "median") %>% 
	mutate(question_number = as.numeric(question_number))
```

### Question 1 through 19  

Scale: `1` = No gain, `2` = A little gain, `3` = Moderate gain, `4` = Good gain, `5` = Great gain

```{r q1-19, echo=FALSE}
post1to19 <- post_reeu_data_num %>% 
	select(as.character(1:19)) %>% 
	likert() 

plot(post1to19)
```

Full question text of questions 1 through 19 is in the following table:  

Question prefix = `r post_reeu_lookup$question_prefix[1]`

```{r q1to19-text, echo=FALSE, message=FALSE}
get_questions <- function(rated_qs, result_lev){
questions <- post_reeu_lookup %>% 
	dplyr::select(-question) %>% 
	filter(question_number %in% {{rated_qs}}) %>% 
	left_join(summary({{result_lev}}) %>% 
							mutate(question_number = as.numeric(as.character(Item)))) %>%
	left_join(filter(median_resp_post, question_number %in% {{rated_qs}})) %>% 
	arrange(high) %>% 
	dplyr::select(1, 3, "median")

questions <- questions[nrow(questions):1,]

kable(questions) %>% 
	kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
}

get_questions(rated_qs = as.character(1:19),
							result_lev = post1to19)
```

### Question 20 through 25  

Scale: `1` = None, `2` = A little, `3` = Some, `4` = A fair amount, `5` = A great deal

```{r q20-25, echo=FALSE}
post20to25 <- post_reeu_data_num %>% 
	select(as.character(20:25)) %>% 
	likert() 

plot(post20to25)
```

Full question text of questions 20 through 25 is in the following table:  

Question prefix = `r post_reeu_lookup$question_prefix[20]`

```{r q20to25-text, echo=FALSE, message=FALSE}
get_questions(rated_qs = as.character(20:25),
							result_lev = post20to25)
```

### Question 26 through 29  

Scale: `1` = Poor, `2` = Fair, `3` = Good, `4` = Excellent

```{r q26-29, echo=FALSE}
post26to29 <- post_reeu_data_num %>% 
	select(as.character(26:29)) %>% 
	mutate_all(factor, levels = c("1", "2", "3", "4"), ordered = TRUE) %>% 
	likert() 

plot(post26to29)
```

Full question text of questions 26 through 29 is in the following table:  

Question prefix = `r post_reeu_lookup$question_prefix[26]`

```{r q26to29-text, echo=FALSE, message=FALSE}
get_questions(rated_qs = as.character(26:29),
							result_lev = post26to29)
```

### Question 30 through 33  

Scale: `1` = Not more likely, `2` = A little more likely, `3` = Somewhat more likely, `4` = Much more likely, `5` = Extremely more likely

```{r q30-33, echo=FALSE}
post30to33 <- post_reeu_data_num %>% 
	select(as.character(30:33)) %>% 
	likert() 

plot(post30to33)
```

Full question text of questions 30 through 33 is in the following table:  

Question prefix = `r post_reeu_lookup$question_prefix[30]`

```{r q30to33-text, echo=FALSE, message=FALSE}
get_questions(rated_qs = as.character(30:33),
							result_lev = post30to33)
```

### Question 34 through 38  

Scale: `1` = Very dissatisfied, `2` = Somewhat dissatisfied, `3` = Somewhat satisfied, `4` = Very satisfied

```{r q34-38, echo=FALSE}
post34to38 <- post_reeu_data_num %>% 
	select(as.character(34:38)) %>% 
	mutate_all(factor, levels = c("1", "2", "3", "4"), ordered = TRUE) %>% 
	likert() 

plot(post34to38)
```

Full question text of questions 34 through 38 is in the following table:  

Question prefix = `r post_reeu_lookup$question_prefix[34]`

```{r q34to38-text, echo=FALSE, message=FALSE}
get_questions(rated_qs = as.character(34:38),
							result_lev = post34to38)
```

### Text entry questions (Post survey)  

**Answers to question:** *`r post_reeu_lookup$question_text[39]`*

```{r textq1, echo=FALSE, message=FALSE}
# text responses
post_reeu_data_chr <- post_reeu_data %>% 
	dplyr::select(-response_num) %>% 
	filter(!is.na(response_chr)) %>% 
	spread(key = question_number,
				 value = response_chr)

kable(post_reeu_data_chr$`39`, col.names = "Student responses")%>% 
	kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

**Answers to question:** *`r post_reeu_lookup$question_text[40]`*

```{r textq2, echo=FALSE, message=FALSE}
knitr::kable(post_reeu_data_chr$`40`, col.names = "Student responses")%>% 
	kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

## Post survey (Mentors)

### Rating style questions

Scale: `1` = No gain, `2` = A little gain, `3` = Moderate gain, `4` = Good gain, `5` = Great gain

```{r import-data, echo=FALSE, message=FALSE}
mentor <- read_csv("post-REEU-mentor-survey.csv")

mentor_num <- mentor %>% 
	slice(2:n()) %>% 
	select(Q2_1:Q3_1) %>% 
	mutate_all(~dplyr::recode(., `Not applicable` = "0", `No gain` = "1", `A little gain` = "2",
														`Moderate gain` = "3", `Good gain` = "4", `Great gain` = "5",
														Poor = "1", Fair = "2", Good = "3", Excellent = "4")) %>% 
	mutate_all(as.numeric) %>% 
	as.data.frame()

# calculate medians
median_resp_mentor <- mentor_num %>% 
	summarise_all(median, na.rm = TRUE) %>% 
	gather(key = "question_num",
				 value = "median")

# plot mentor responses
result_mentor <- mentor_num %>% 
	dplyr::select(-Q3_1) %>% 
	mutate_all(factor, levels = c("1", "2", "3", "4", "5"), ordered = TRUE) %>% 
	likert()

plot(result_mentor)
```

Full question text of above questions in the following table:  

Question prefix = How much did your student intern gain in the following areas as a result of their research/extension experience in summer 2019?

```{r mentor-qs, echo=FALSE, message=FALSE}
questions <- mentor %>% 
	slice(1) %>% 
	dplyr::select(Q2_1:Q2_16) %>% 
	gather(question_num, question) %>% 
	separate(question, into = c("question_prefix", "question_text"), sep = "-") %>% 
	dplyr::select(-question_prefix) %>% 
	left_join(summary(result_mentor) %>% 
							mutate(question_num = as.character(Item))) %>% 
	left_join(filter(median_resp_mentor, question_num != "Q3_1")) %>% 
	arrange(high) %>% 
	dplyr::select(1, 2, "median") %>% 
	mutate(question_text = gsub("[^a-zA-Z ]", "", question_text))

questions <- questions[nrow(questions):1,]

kable(questions) %>% 
	kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Text entry style questions

```{r echo=FALSE}
mentor_chr <- mentor %>% 
	dplyr::select(Q4:Q7)
```

**Answers to question:** *`r mentor_chr$Q4[1]`*

```{r textQ4, echo=FALSE, message=FALSE}
knitr::kable(mentor_chr$Q4[2:nrow(mentor_chr)], col.names = "Mentor responses")%>% 
	kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

**Answers to question:** *`r mentor_chr$Q5[1]`*

```{r textQ5, echo=FALSE, message=FALSE}
knitr::kable(mentor_chr$Q5[2:nrow(mentor_chr)], col.names = "Mentor responses")%>% 
	kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

**Answers to question:** *`r mentor_chr$Q6[1]`*

```{r textQ6, echo=FALSE, message=FALSE}
knitr::kable(mentor_chr$Q6[2:nrow(mentor_chr)], col.names = "Mentor responses")%>% 
	kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

**Answers to question:** *`r mentor_chr$Q7[1]`*

```{r textQ7, echo=FALSE, message=FALSE}
knitr::kable(mentor_chr$Q7[2:nrow(mentor_chr)], col.names = "Mentor responses")%>% 
	kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

## Student vs. mentor assessment

```{r echo=FALSE, message=FALSE}
com_qs_students <- post_reeu_data_num %>% 
	dplyr::select(-c(`12`, `13`, `14`, `20`:`25`, `27`:`38`)) %>% 
	gather(key = "question_number", value = "rating") %>% 
	mutate_all(as.numeric) %>% 
	group_by(question_number) %>% 
	summarise(student_mean = mean(rating, na.rm = TRUE),
						student_se = std.error(rating, na.rm = TRUE))

com_qs_mentors <- mentor_num %>% 
	gather(key = "question_number", value = "rating") %>% 
	group_by(question_number) %>% 
	summarise(mentor_mean = mean(rating, na.rm = TRUE),
						mentor_se = std.error(rating, na.rm = TRUE)) %>% 
	mutate_at(vars(question_number), ~dplyr::recode(., `Q3_1` = "3_26",
																									`Q2_12` = "Q2_15",
																									`Q2_13` = "Q2_16",
																									`Q2_14` = "Q2_17",
																									`Q2_15` = "Q2_18",
																									`Q2_16` = "Q2_19")) %>% 
	separate(question_number, into = c("delete", "question_number"), sep = "_") %>% 
	dplyr::select(-delete) %>% 
	mutate_at(vars(question_number), as.numeric) 

com_qs <- left_join(com_qs_mentors, com_qs_students) %>% 
	arrange(question_number) %>% 
	left_join(post_reeu_lookup %>% 
							dplyr::select(question_number, question_text)) %>% 
	gather(key = "Responder", value = "statistic_value", c(mentor_mean:student_se)) %>% 
	separate(col = Responder, c("Responder", "statistic"), sep = "_") %>% 
	spread(key = statistic, value = statistic_value)

# plot
ggplot(data = com_qs, mapping = aes(x = reorder(question_text, mean), y = mean)) +
	geom_col(mapping = aes(fill = Responder), position = "dodge2", alpha = 0.6) +
	coord_flip() +
	scale_fill_brewer(type = "qual") +
	geom_errorbar(mapping = aes(ymin = mean - se,
															ymax = mean + se,
															color = Responder), position = "dodge2") +
	scale_color_brewer(type = "qual") +
	xlab(label = NULL)
		
```

Scale: `1` = No gain, `2` = A little gain, `3` = Moderate gain, `4` = Good gain, `5` = Great gain

### Pre vs. post assessment

There were 11 questions that were asked in both pre and post surveys. Let's see if there is increase in rating for these questions as a result of the internship.

```{r pre-post, echo=FALSE, message=FALSE}
com_pre_qs <- c(2:3, 5:11, 13, 15)
com_post_qs <- c(1, 2, 8, 12:19)

com_pre <- pre_reeu_data %>% 
	filter(!is.na(response_num) & question_number %in% com_pre_qs) %>% 
	dplyr::select(question_number, response_num) %>% 
	group_by(question_number) %>% 
	summarise(pre_mean = mean(response_num, na.rm = TRUE),
						pre_se = std.error(response_num, na.rm = TRUE)) %>% 
	rename(pre_id = question_number) %>% 
	rowid_to_column(., "com_id")

com_post <- post_reeu_data %>% 
	filter(!is.na(response_num) & question_number %in% com_post_qs) %>% 
	dplyr::select(question_number, response_num) %>% 
	group_by(question_number) %>% 
	summarise(post_mean = mean(response_num, na.rm = TRUE),
						post_se = std.error(response_num, na.rm = TRUE)) %>% 
	mutate(post_id = question_number) %>% 
	mutate_at(vars(question_number), ~dplyr::recode(., `15` = "3", `12` = "4", `13` = "5",
																									`14` = "6", `16` = "7", `17` = "8",
																									`18` = "9", `19` = "10", `8` = "11",
																									`1` = "1", `2` = "2")) %>% 
	mutate(com_id = as.integer(question_number)) %>% 
	dplyr::select(-question_number)

com <- left_join(com_pre, com_post) %>% 
	left_join(post_reeu_lookup %>% 
							dplyr::select(question_number, question_text),
						by = c("post_id" = "question_number")) %>% 
	dplyr::select(-pre_id, -post_id) %>% 
	gather(key = "Survey", value = "statistic_value", c(pre_mean:post_se)) %>% 
	separate(col = Survey, c("Survey", "statistic"), sep = "_") %>% 
	spread(key = statistic, value = statistic_value)

# plot
ggplot(data = com, mapping = aes(x = reorder(question_text, mean), y = mean)) +
	geom_col(mapping = aes(fill = Survey), position = "dodge2", alpha = 0.6) +
	coord_flip() +
	scale_fill_brewer(type = "qual") +
	geom_errorbar(mapping = aes(ymin = mean - se,
															ymax = mean + se,
															color = Survey), position = "dodge2") +
	scale_color_brewer(type = "qual") +
	xlab(label = NULL)
```

